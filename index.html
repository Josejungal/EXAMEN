<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Calculadora Simplex Mejorada (Paso a Paso)</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjs/11.11.0/math.min.js"></script>
  <style>
    body { font-family: 'Segoe UI', sans-serif; background: #f4f7f8; padding: 20px; color: #333; }
    .container { max-width: 900px; margin: auto; background: #fff; padding: 30px; border-radius: 8px; box-shadow: 0 0 15px rgba(0,0,0,0.1); }
    h2 { text-align: center; color: #007bff; }
    label { font-weight: bold; margin-top: 20px; display: block; }
    input, textarea, button { width: 100%; font-size: 16px; margin-top: 10px; padding: 10px; border-radius: 5px; border: 1px solid #ccc; box-sizing: border-box; }
    button { background: #007bff; color: white; margin-top: 20px; border: none; }
    button:hover { background: #0056b3; }
    pre { background: #eef; padding: 15px; border-left: 5px solid #007bff; font-size: 15px; white-space: pre-wrap; margin-top: 20px; }
  </style>
</head>
<body>
<div class="container">
  <h2>Calculadora del Método Simplex (Paso a Paso)</h2>

  <label for="objetivo">Función objetivo (ej: max Z = 3x + 5y):</label>
  <input id="objetivo" placeholder="max Z = 3x + 5y" />

  <label for="restricciones">Restricciones (una por línea, ej: 2x + 3y <= 60):</label>
  <textarea id="restricciones" rows="6" placeholder="Ej:\n2x + y <= 18\n2x + 3y <= 42\n3x + y <= 24"></textarea>

  <button onclick="resolverSimplexPasoAPaso()">Resolver por Método Simplex</button>

  <label>Resultado y Proceso Paso a Paso:</label>
  <pre id="resultado">Esperando datos...</pre>
</div>

<script>
function parseExpr(expr, variables) {
  const vars = {};
  const terms = expr.match(/[+-]?\s*\d*\.?\d*\s*[a-z]/gi);
  if (terms) {
    for (let term of terms) {
      const match = term.match(/([+-]?\s*\d*\.?\d*)\s*([a-z])/i);
      let coef = match[1].replace(/\s/g, '');
      coef = coef === '' || coef === '+' ? 1 : coef === '-' ? -1 : parseFloat(coef);
      vars[match[2].toLowerCase()] = coef;
    }
  }
  return variables.map(v => vars[v] || 0);
}

function resolverSimplexPasoAPaso() {
  const objText = document.getElementById('objetivo').value.toLowerCase();
  const resLines = document.getElementById('restricciones').value.trim().split('\n');
  const resultado = document.getElementById('resultado');

  if (!objText.includes('max')) {
    resultado.textContent = 'Solo se admite "max" en esta versión paso a paso.';
    return;
  }

  const variables = ['x', 'y'];
  const numVars = variables.length;
  const numRes = resLines.length;

  const c = parseExpr(objText, variables);
  const A = [];
  const b = [];

  for (let line of resLines) {
    const parts = line.match(/(.+)(<=|>=|=)(.+)/);
    if (!parts) {
      resultado.textContent = `Error en la restricción: "${line}".`;
      return;
    }
    const [left, sign, right] = parts.slice(1).map(s => s.trim());
    const row = parseExpr(left, variables);
    A.push(row);
    b.push(parseFloat(right));
  }

  const tableau = A.map((row, i) => {
    const slack = Array(numRes).fill(0);
    slack[i] = 1;
    return [...row, ...slack, b[i]];
  });

  const zRow = [...c.map(v => -v), ...Array(numRes).fill(0), 0];
  tableau.push(zRow);

  let pasos = [];
  const varNames = [...variables, ...Array.from({length: numRes}, (_, i) => `s${i+1}`), 'RHS'];

  pasos.push('Tabla inicial con variables de holgura:');
  pasos.push(formatearTabla(tableau, varNames));

  let iter = 0;
  while (true) {
    const lastRow = tableau[tableau.length -1];
    const minVal = Math.min(...lastRow.slice(0, lastRow.length -1));

    if (minVal >= 0) break;

    const pivotCol = lastRow.indexOf(minVal);

    const ratios = tableau.slice(0, -1).map(row => {
      const val = row[pivotCol];
      return val > 0 ? row[row.length -1] / val : Infinity;
    });

    const pivotRow = ratios.indexOf(Math.min(...ratios));

    if (pivotRow === -1) {
      pasos.push('No hay solución factible.');
      break;
    }

    const pivotVal = tableau[pivotRow][pivotCol];

    for (let j = 0; j < tableau[pivotRow].length; j++) {
      tableau[pivotRow][j] /= pivotVal;
    }

    for (let i = 0; i < tableau.length; i++) {
      if (i !== pivotRow) {
        const factor = tableau[i][pivotCol];
        for (let j = 0; j < tableau[i].length; j++) {
          tableau[i][j] -= factor * tableau[pivotRow][j];
        }
      }
    }

    iter++;
    pasos.push(`Iteración ${iter}:`);
    pasos.push(formatearTabla(tableau, varNames));
  }

  const zOpt = tableau[tableau.length -1][tableau[0].length -1];
  pasos.push(`Solución óptima Z = ${zOpt.toFixed(2)}`);

  resultado.textContent = pasos.join('\n\n');
}

function formatearTabla(matrix, headers) {
  const headerRow = headers.map(h => h.padStart(6)).join(' ');
  const rows = matrix.map(row => row.map(v => v.toFixed(2).padStart(6)).join(' '));
  return [headerRow, ...rows].join('\n');
}
</script>
</body>
</html>
